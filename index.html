<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Sudoku 6x6 - Login</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>

<style>
* { font-family: 'Poppins', sans-serif; box-sizing: border-box; }
body { margin:0; background:#0a0f1e; color:white; height:100vh; display:flex; align-items:center; justify-content:center; }

.card {
  width:360px;
  padding:40px;
  border-radius:25px;
  background:rgba(255,255,255,0.06);
  backdrop-filter: blur(20px);
  box-shadow:0 20px 40px rgba(0,0,0,.5);
  text-align:center;
}

h2 { font-weight:800; margin-bottom:20px; }

input {
  width:100%;
  padding:14px;
  margin-bottom:14px;
  border-radius:12px;
  border:none;
  background:rgba(0,0,0,.5);
  color:white;
  outline:none;
}

button {
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  background:linear-gradient(135deg,#0a66c2,#004a91);
  color:white;
  font-weight:600;
  cursor:pointer;
}

.toggle {
  margin-top:15px;
  font-size:0.85rem;
  color:#aaa;
  cursor:pointer;
}

#msg {
  min-height:18px;
  margin-bottom:10px;
  font-size:0.8rem;
  font-weight:600;
}
</style>
</head>

<body>

<!-- ðŸ”’ AUTO LOGIN CHECK -->
<script>
if (localStorage.getItem("gamerName")) {
  window.location.replace("main.html");
}
</script>

<div class="card">
  <h2 id="title">SIGN UP</h2>

  <input id="username" placeholder="Username" maxlength="15">
  <input id="password" type="password" placeholder="Password">

  <div id="msg"></div>

  <button id="btn" onclick="submitForm()">Create Account</button>

  <div class="toggle" onclick="toggleMode()" id="toggleText">
    Already have an account? Login
  </div>
</div>

<script>
const firebaseConfig = {
  databaseURL: "https://sudokugame6x6-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let loginMode = false;

function toggleMode() {
  loginMode = !loginMode;
  title.innerText = loginMode ? "WELCOME BACK" : "SIGN UP";
  btn.innerText = loginMode ? "Login" : "Create Account";
  toggleText.innerText = loginMode ? "New player? Create Account" : "Already have an account? Login";
  msg.innerText = "";
}

async function submitForm() {
  const user = username.value.trim();
  const pass = password.value.trim();

  if (user.length < 3 || pass.length < 4) {
    msg.innerText = "Too short username or password";
    msg.style.color = "red";
    return;
  }

  const hash = sha256(pass);
  const ref = db.ref("players/" + user);
  const snap = await ref.once("value");

  if (loginMode) {
    if (snap.exists() && snap.val().password === hash) {
      localStorage.setItem("gamerName", user);
      localStorage.setItem("coins", snap.val().coins || 50);
      msg.innerText = "Login successful!";
      msg.style.color = "#00ff88";
      setTimeout(() => window.location.replace("main.html"), 800);
    } else {
      msg.innerText = "Invalid login details";
      msg.style.color = "red";
    }
  } else {
    if (snap.exists()) {
      msg.innerText = "User already exists";
      msg.style.color = "red";
    } else {
      await ref.set({ username: user, password: hash, coins: 50 });
      localStorage.setItem("gamerName", user);
      localStorage.setItem("coins", 50);
      msg.innerText = "Account created!";
      msg.style.color = "#00ff88";
      setTimeout(() => window.location.replace("main.html"), 800);
    }
  }
}
</script>

</body>
</html>
