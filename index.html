<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ✅ PWA MANIFEST -->
    <link rel="manifest" href="manifest.json">

    <title>Secure Login - Sudoku 6</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>

    <style>
        * { font-family: 'Poppins', sans-serif; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #090a0f; color: white; }
        #bgCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        .center-box {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); z-index: 10;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(25px);
            padding: 40px;
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 380px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        h2 { font-weight: 800; font-size: 1.8rem; margin-bottom: 20px; letter-spacing: 2px; }

        input {
            width: 100%; padding: 14px; margin-bottom: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.4);
            color: white;
            outline: none;
        }

        .start-btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: linear-gradient(135deg, #0a66c2, #004a91);
            color: white;
            font-weight: 600;
        }

        .toggle-link {
            margin-top: 20px;
            cursor: pointer;
            color: #888;
        }

        .status-msg {
            min-height: 1.2rem;
            font-size: 0.8rem;
            font-weight: 600;
        }
    </style>
</head>

<body>

<canvas id="bgCanvas"></canvas>

<div class="center-box">
    <div class="glass-card">
        <h2 id="formTitle">SIGN UP</h2>

        <input type="text" id="userInput" placeholder="Username" maxlength="15">
        <input type="password" id="passInput" placeholder="Password">

        <div id="statusMsg" class="status-msg"></div>

        <button class="start-btn" id="mainBtn" onclick="handleSubmit()">Create Account</button>

        <div class="toggle-link" onclick="toggleMode()">
            <span id="toggleText">Already have an account? Login</span>
        </div>
    </div>
</div>

<script src="motion.js"></script>

<!-- ✅ SERVICE WORKER REGISTRATION (THIS IS WHAT YOU ASKED) -->
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<script>
const firebaseConfig = {
  databaseURL: "https://sudokugame6x6-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let isLoginMode = false;

function toggleMode() {
    isLoginMode = !isLoginMode;
    document.getElementById("formTitle").innerText = isLoginMode ? "WELCOME BACK" : "SIGN UP";
    document.getElementById("mainBtn").innerText = isLoginMode ? "Login" : "Create Account";
}

async function handleSubmit() {
    const user = userInput.value.trim();
    const pass = passInput.value.trim();
    const status = statusMsg;

    if (user.length < 3 || pass.length < 4) {
        status.innerText = "Username or password too short!";
        status.style.color = "red";
        return;
    }

    const hashedPass = sha256(pass);
    const userRef = db.ref("players/" + user);
    const snap = await userRef.once("value");

    if (isLoginMode) {
        if (snap.exists() && snap.val().password === hashedPass) {
            localStorage.setItem("gamerName", user);
            window.location.href = "main.html";
        } else {
            status.innerText = "Invalid login!";
            status.style.color = "red";
        }
    } else {
        if (snap.exists()) {
            status.innerText = "User already exists!";
            status.style.color = "red";
        } else {
            await userRef.set({ username: user, password: hashedPass, coins: 50 });
            window.location.href = "main.html";
        }
    }
}
</script>

</body>
</html>
